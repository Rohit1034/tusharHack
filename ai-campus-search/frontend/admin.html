<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AI Campus Search</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="dashboard-container">
        <div class="gradient-bg"></div>
        <nav class="navbar glass-card">
            <h2>Admin Dashboard</h2>
            <div class="nav-links">
                <span id="adminName">Admin</span>
                <button id="adminLogoutBtn" class="btn-secondary">Logout</button>
            </div>
        </nav>
        
        <main class="main-content">
            <section class="stats-section glass-card">
                <h3>System Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Total Users</h4>
                        <p id="totalUsers">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Total Documents</h4>
                        <p id="totalDocuments">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Total Searches</h4>
                        <p id="totalSearches">0</p>
                    </div>
                </div>
            </section>
            
            <section class="documents-section glass-card">
                <h3>Uploaded Documents</h3>
                <table id="documentsTable">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Department</th>
                            <th>Uploaded By</th>
                            <th>Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="documentsList">
                        <tr><td colspan="5">Loading documents...</td></tr>
                    </tbody>
                </table>
            </section>
        </main>
    </div>
    <!-- API Configuration -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // API_URL is already defined in config.js
        
        // Admin functionality will be implemented in dashboard.js
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            // Load admin stats
            await loadAdminStats();
            // Load documents
            await loadDocuments();
            
            document.getElementById('adminLogoutBtn').addEventListener('click', function() {
                localStorage.removeItem('token');
                window.location.href = 'login.html';
            });
        });
        
        async function loadAdminStats() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/admin/stats`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const stats = await response.json();
                document.getElementById('totalUsers').textContent = stats.totalUsers;
                document.getElementById('totalDocuments').textContent = stats.totalDocuments;
                document.getElementById('totalSearches').textContent = stats.totalSearches;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        async function loadDocuments() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/admin/documents`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const documents = await response.json();
                const tbody = document.getElementById('documentsList');
                tbody.innerHTML = '';
                
                documents.forEach(doc => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${doc.title}</td>
                        <td>${doc.department}</td>
                        <td>${doc.uploadedBy ? doc.uploadedBy.name : 'Unknown'}</td>
                        <td>${new Date(doc.createdAt).toLocaleDateString()}</td>
                        <td><button class="btn-danger delete-btn" data-id="${doc._id}">Delete</button></td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Add event listeners for delete buttons
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const docId = this.getAttribute('data-id');
                        if (confirm('Are you sure you want to delete this document?')) {
                            try {
                                const response = await fetch(`${API_URL}/admin/document/${docId}`, {
                                    method: 'DELETE',
                                    headers: {
                                        'Authorization': `Bearer ${token}`
                                    }
                                });
                                
                                if (response.ok) {
                                    alert('Document deleted successfully');
                                    loadDocuments(); // Reload the table
                                } else {
                                    alert('Failed to delete document');
                                }
                            } catch (error) {
                                console.error('Error deleting document:', error);
                                alert('Error deleting document');
                            }
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading documents:', error);
            }
        }
    </script>
</body>
</html>